

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Python API &mdash; Aviso 0.8.0 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/style.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="CLI for Configuration System" href="configuration_cli.html" />
    <link rel="prev" title="CLI for Notification System" href="notification_cli.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html">
          

          
            
            <img src="../_static/logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">User Guide:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../guide/overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../guide/getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../guide/defining_my_listener.html">Defining my listener</a></li>
<li class="toctree-l1"><a class="reference internal" href="../guide/testing_my_listener.html">Testing my listener</a></li>
<li class="toctree-l1"><a class="reference internal" href="../guide/historical_notifications.html">Dealing with historical notifications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../guide/python_api.html">Aviso as a Python API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../guide/running_service.html">Running as a service</a></li>
<li class="toctree-l1"><a class="reference internal" href="../guide/examples.html">Listener Examples</a></li>
</ul>
<p class="caption"><span class="caption-text">Reference:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="configuration.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="triggers.html">Triggers</a></li>
<li class="toctree-l1"><a class="reference internal" href="notification_cli.html">CLI for Notification System</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Python API</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#listen">Listen</a></li>
<li class="toctree-l2"><a class="reference internal" href="#notify">Notify</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="configuration_cli.html">CLI for Configuration System</a></li>
</ul>
<p class="caption"><span class="caption-text">Contributing:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../contributing/how_to.html">How to develop</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing/aviso_client.html">Aviso Client Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing/aviso_server.html">Aviso Server Architecture</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Aviso</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Python API</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/reference/python_api.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="python-api">
<span id="python-api-ref"></span><h1>Python API<a class="headerlink" href="#python-api" title="Permalink to this headline">¶</a></h1>
<p>Aviso provides a Python API for the key operations that concern the notification workflow: <code class="docutils literal notranslate"><span class="pre">listen</span></code> and <code class="docutils literal notranslate"><span class="pre">notify</span></code>.
This API has the same level of expressiveness than the CLI.</p>
<p>This is intended for users that want to integrate Aviso in a workflow or application
written in Python. An example of integration of Aviso in a external Python application is the server component <strong>Aviso-rest</strong>,
described in <a class="reference internal" href="../contributing/aviso_server.html#aviso-server"><span class="std std-ref">Aviso Server Architecture</span></a>.
This component internally relies on Aviso to submit notification to the store.</p>
<div class="section" id="listen">
<h2>Listen<a class="headerlink" href="#listen" title="Permalink to this headline">¶</a></h2>
<p>This method is used to start the polling for changes from Aviso client to Aviso server. This allows the user to retrieve
new notifications as they are submitted to Aviso server.</p>
<p>Below an example of a python script that defines a function to be executed once a notification is received,
creates a listener that references to this function trigger and finally passes it to aviso to execute.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyaviso</span> <span class="kn">import</span> <span class="n">NotificationManager</span>

<span class="c1"># define function to be called</span>
<span class="k">def</span> <span class="nf">do_something</span><span class="p">(</span><span class="n">notification</span><span class="p">):</span>
   <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Notification for step </span><span class="si">{</span><span class="n">notification</span><span class="p">[</span><span class="s1">&#39;request&#39;</span><span class="p">][</span><span class="s1">&#39;step&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> received&quot;</span><span class="p">)</span>
   <span class="c1"># now do something useful with it ...</span>

<span class="c1"># define the trigger</span>
<span class="n">trigger</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;function&quot;</span><span class="p">,</span> <span class="s2">&quot;function&quot;</span><span class="p">:</span> <span class="n">do_something</span><span class="p">}</span>

<span class="c1"># create a event listener request that uses that trigger</span>
<span class="n">request</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;class&quot;</span><span class="p">:</span> <span class="s2">&quot;od&quot;</span><span class="p">,</span> <span class="s2">&quot;stream&quot;</span><span class="p">:</span> <span class="s2">&quot;oper&quot;</span><span class="p">,</span> <span class="s2">&quot;expver&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;domain&quot;</span><span class="p">:</span> <span class="s2">&quot;g&quot;</span><span class="p">,</span> <span class="s2">&quot;step&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
<span class="n">listeners</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;listeners&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;event&quot;</span><span class="p">:</span> <span class="s2">&quot;mars&quot;</span><span class="p">,</span> <span class="s2">&quot;request&quot;</span><span class="p">:</span> <span class="n">request</span><span class="p">,</span> <span class="s2">&quot;triggers&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">trigger</span><span class="p">]}]}</span>

<span class="c1"># run it</span>
<span class="n">aviso</span> <span class="o">=</span> <span class="n">NotificationManager</span><span class="p">()</span>
<span class="n">aviso</span><span class="o">.</span><span class="n">listen</span><span class="p">(</span><span class="n">listeners</span><span class="o">=</span><span class="n">listeners</span><span class="p">)</span>
</pre></div>
</div>
<p>This script will put the main process is busy waiting while polling at regular time the server.
All the various types of triggers presented in <a class="reference internal" href="triggers.html#triggers"><span class="std std-ref">Triggers</span></a> can also be defined or manually loaded from file.</p>
<p>The object <code class="docutils literal notranslate"><span class="pre">NotificationManager</span></code> can take as parameter a <code class="docutils literal notranslate"><span class="pre">user_config.UserConfig</span></code> object. If not passed the
manager object will instantiate a config object following the criteria explained in <a class="reference internal" href="configuration.html#configuration"><span class="std std-ref">Configuration</span></a>.
Alternatively the user can create and customise a <code class="docutils literal notranslate"><span class="pre">UserConfig</span></code>. This can be useful to customise the application setup.</p>
</div>
<div class="section" id="notify">
<h2>Notify<a class="headerlink" href="#notify" title="Permalink to this headline">¶</a></h2>
<p>This method is used to submit notification. End-users are not currently allowed to submit to ECMWF notification server but
they can submit notification in test mode, see <a class="reference internal" href="../guide/testing_my_listener.html#testing-my-listener"><span class="std std-ref">Testing my listener</span></a>, or to local instances of the store.
The example belows shows how to send a <code class="docutils literal notranslate"><span class="pre">mars</span></code> notification.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyaviso</span> <span class="kn">import</span> <span class="n">NotificationManager</span>

<span class="n">aviso</span> <span class="o">=</span> <span class="n">NotificationManager</span><span class="p">()</span>

<span class="c1"># define the parameters of the notification</span>
<span class="n">notification</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;event&quot;</span><span class="p">:</span> <span class="s2">&quot;mars&quot;</span><span class="p">,</span>
    <span class="s2">&quot;class&quot;</span><span class="p">:</span> <span class="s2">&quot;od&quot;</span><span class="p">,</span>
    <span class="s2">&quot;stream&quot;</span><span class="p">:</span> <span class="s2">&quot;oper&quot;</span><span class="p">,</span>
    <span class="s2">&quot;expver&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s2">&quot;domain&quot;</span><span class="p">:</span> <span class="s2">&quot;g&quot;</span><span class="p">,</span>
    <span class="s2">&quot;step&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s2">&quot;date&quot;</span><span class="p">:</span> <span class="s2">&quot;20190810&quot;</span><span class="p">,</span>
    <span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="s2">&quot;0&quot;</span>
    <span class="p">}</span>

<span class="c1"># send the notification</span>
<span class="n">aviso</span><span class="o">.</span><span class="n">notify</span><span class="p">(</span><span class="n">notification</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="configuration_cli.html" class="btn btn-neutral float-right" title="CLI for Configuration System" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="notification_cli.html" class="btn btn-neutral float-left" title="CLI for Notification System" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, ECMWF

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>